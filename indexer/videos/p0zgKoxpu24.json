{
  "id": "p0zgKoxpu24",
  "title": "Integrate Azure functions with Azure KeyVault",
  "transcript": "alright hello everybody today I'm gonna\nshow you how to integrate as your\nfunctions with your key ball I'm going\nto try to keep it super simple not\nwasting anybody's time so let's get\nright into it\nthing i need to do is actually create a\nfolder\nand then we're just gonna open that up\nin visual code perfect and first thing\nwe got to do is create an azure function\nso we'll click this create function and\nwe'll use the current folder that we're\nin perfect I'm gonna use c-sharp because\nit's my favorite this of course will\nwork in any language you decide to use\nand all these defaults are fine so I'm\njust going to hit the default options\nthat are selected when you create a\nfunction and I guess we have to fix\nthese visual code errors that I have I'm\ngonna have to reinstall visual code or\nsomething because I get these errors all\nthe time\nI still love visual code don't get me\nwrong all right so you know when you\nhave an application you typically have\nsomewhere to save environment variables\nfor C sharp and dotnet you have the\nlocal that settings that JSON so I'm\ngonna give you an example here if I\ncreate the value called let's actually\ncall it first name and then we'll say\nthis is Gweneth just going first name so\nif you go back to the code itself and\nwe're actually going to erase all of\nthis because we don't need any of it we\ncan create a variable called string\nfirst name equals system dot and fireman\ndot get environment variable and just\nget the environment variable named first\nand then we're just gonna print out the\nvariable perfect so let's run this and\nlet's see what happens when we actually\nexecute the function this should give us\na URL shortly then we can command click\non it and get right to the function\nperfect and we see we're opening up the\nfunction and we see\nGweneth perfect so let's go back to the\nfunction and we're gonna stop this now\nthe issue here we have two things when\nyou deploy and as your function actually\nto Azure to a production and by\nthis file local that settings that JSON\ndoes not get pushed this only stays on\nyour local machine where your locally\ndeveloping and that's for good reason\nbecause you would never want to push\nsomething that actually has these\nenvironment variables easily accessible\nso that's where key Balt falls into\nplace so what we're gonna do right now\nis just deploy this function to measure\nso we're gonna do deploy to function app\nand we're gonna select create a new\nfunction and we're just gonna call\nintegrative kv func - we call it -\nbecause i think i was messing around\nwith this before then it just asks for\nthe location so let's go to cue ball\nwe're gonna create one of those we're\ngonna create a new key vault and we're\ngoing to create a new resource group\nintegrate kv func\nshin research group and then we're gonna\ncall the integrate the key ball\nintegrate kv funk\nperfect east us to is best for me\nstandard okay\nyou can leave everything else as is hit\nreview and create and create that hit\ncreate awesome now your deployment is\nunderway perfect let's see what the\nstatus of the deployment of the function\nis it's on step five out of five ok so\nright now it's just a waiting gamealrighty so back in the function it\nlooks like it deployed and we're gonna\ngo over to Safari and the keyboard also\nso let's finish up the setup in the key\nball so keep all this cool read up on\nthe documentation you can store keys and\nsecrets and certificates and all that\nboard just interested in secrets right\nnow so we're gonna go up here and create\na new secret we're gonna name it first\nname and the value is just going to be\nmy first name\nwe don't need any of that we're just\ngonna hit create right now perfect\nwe're gonna hit refresh and if you\nactually click in there you'll see you\nhave a current version and if it's\nenabled and all the other details that\nyou need every time you create or you\nupdate secret you're gonna get a new\nversion so we actually click click into\nthe current version we see we have some\ndetails here but the most important\nproperty is this URL that we're going to\nneed soon but we don't need it at the\nmoment so we're gonna let that be we're\ngonna open up another another tab into\nAzure and we're actually going to go to\nthe function the function that we just\ndeployed so let's go to function app and\nI remember it's number two so we're\nclicking to number two and I'm going to\nshow you where you would see your\napplication settings so you go in to\nmake sure you're at the plan level and\nthen you're gonna hit function app\nsettings and then you're going to go to\nmanage application settings once you're\nin here you can see that you have a very\nsimilar value to the local dot settings\na JSON file you have a name and value\nand if you click on advanced edit you'll\nhave a format that's a lesson right so\nright now what we need to do is update\nthe variable that it's going to put that\nthe function is actually pulling so\nfirst name and it's Gweneth right so\nbefore I actually save this we're going\nto I'm gonna access the URL of the\nfunction and show you that it doesn't\npull any value because it doesn't know\nit doesn't have that name and value pair\nset anywhere so if you go into the\nfunction itself you can pull the URL you\ncan grab the URL here and just paste and\ngo and you see that it returns no value\nbecause it doesn't know what to do it\ndoesn't have anything to return so back\ninto the application settings again we\nadded first-name goeth and we're gonna\nhit save continue so this should update\nandwe're gonna do yeah I think this is\nright now we're load and load and load\nin come on I think every time you update\nyour application settings it restarts\nthe function so it takes a little longer\nto get called once it's starting up so\nyou see now we see the value on earth if\nwe were to change this it would update\nit as well\nnow the only issue here is again you\nhave all this information sort of just\ndisplayed all the person who's working\non this has to do is click into\napplication settings of the function and\nyou'd be able to see this value but this\nisn't as secure as we could make it what\nif we were able to abstract it one level\nmore and that's what we're actually\ngoing to do now so let's go back to the\nfunction app itself and we're gonna go\ninto platform features and we're gonna\ngo into identity under system identity\nyou're going to select the status and\nyou're gonna turn that on save what this\nis enabling the function to do is it's\nallowing itself to have the feature to\nhave policies assigned to itself so you\nsee here you can control its access to\nservices like resource manager key ball\netc right awesome so now we have\neverything that the function needs to be\nable to work with the policy we just\nhave to assign a policy to itself who is\ngoing to give the policy the Keeble so\nnow we're gonna go to the key vault did\nI have the key vault open yes I do so\nwe're gonna go over to the key Balt\noverview and in the keyboard itself\nyou're gonna go to access policies and\nyou're going to add an access policy\nconfigure from template yes we've only\nwanted to have access to secrets\nso that'll already check these off here\nand then you're going to select the\nprincipal principal just means which\nidentity is assuming this policy and\nit's going to be our function it's a\ngreat and it's number two here and then\njust hit select\nand then ya hit add awesome then you hit\nsave great so now we have that\nconnection there the function can listen\nto the policy and the policy has been\nassigned by the key ball perfect so next\nup we have to actually do is get into\nthe secret remember I told you that\nwe're going to need the URL inside of\nthe properties well now we're going to\nuse it so the secret identifier\nyou're gonna copy that and you're gonna\ngo actually back to the functionsapplication settings so we'll go to\nfunction app again settings and then\nwe're going to go to manage application\nsettings come on manage application\nsettings and we're gonna do an advanced\nedit just because I like this editor\nbetter than this one so in here the\nvalue isn't going to be going it anymore\nwe're gonna need to paste in the URL but\nMicrosoft actually has a format that\nyou're supposed to follow I'm gonna\nleave this link which is the just an\nofficial Microsoft documentation page\nand they give you the URL that you're\nsupposed to format things in so if you\nsee it says at Microsoft key what secret\nyou are you are I and then just the URL\nthat we copied so I'm just gonna copy up\nuntil here a copy and then we're just\ngoing to paste that in so here we go\npaste that in there and we just have to\nclose that perfect we're gonna hit OK\nand then we're gonna hit save hit\ncontinue\nawesome so again that has to save and\nrestart the function so we're gonna\nclose these what we're gonna keep that\none open we're gonna close that and\nwe're going to keep looks like updating\nweb app settings was successful so if we\nrefresh this it's pulling gwyneth but\nlet me show you one thing is what if we\nwant it to update all right so let's go\nback into the key ball\nand the secret we're going to add a new\nversion we're gonna say it's now GPS my\ninitials and then we're gonna hit create\nnow the one thing that's a little\ntedious is every time you update a\nsecret you have to manually update the\nURL in the application settings\nI know Microsoft is working on how to\nwork with like the rotation of keys and\nsecrets but I don't think it's been\nimplemented yet so we just have to do it\nmanually so we'll go into that and then\nwe'll update the URL and then hit OK\nthen hit save then hit continue come on\ncome on\nawesome so now if we refresh this page\noh I think it's restarting we didn't\ngive it enough time so we'll see it's\nsort of stuck loading there there we go\nand now we see GPS can you see that yes\nawesome so what does this all mean this\nmeans that in your application settings\nyou no longer need to provide the value\nyou just need to provide where the\nsecret is located inside of key vault\nagain as long as your function has an\nidentity and the function is assigned a\npolicy from the key vault you can get\nthese working fine and I think it\nabstracts the certain responsibilities\nof security like you don't have to hard\ncode any important credentials or\nanything into your code you can just put\nit in key ball and I think it's a very\nhelpful and useful tool to have yeah I\ntry to keep this as short and sweet as\npossible and I would like to continue\nmaking more videos on Azure so you have\nany recommendations please just let me\nknow and I will maybe see you in the\nnext video I don't know",
  "key_phrases": [
    "shin research group",
    "new resource group",
    "visual code perfect",
    "new key vault",
    "visual code errors",
    "local dot settings",
    "function app settings",
    "local machine",
    "new secret",
    "new version",
    "key Balt",
    "default options",
    "two things",
    "good reason",
    "five ok",
    "current version",
    "important property",
    "plan level",
    "advanced edit",
    "key ball",
    "application settings",
    "environment variables",
    "first name",
    "integrative kv",
    "kv func",
    "new function",
    "first thing",
    "current folder",
    "C sharp",
    "other details",
    "update secret",
    "similar value",
    "JSON file",
    "everybody",
    "functions",
    "time",
    "favorite",
    "course",
    "language",
    "defaults",
    "something",
    "dotnet",
    "example",
    "Gweneth",
    "system",
    "fireman",
    "URL",
    "issue",
    "Azure",
    "production",
    "place",
    "location",
    "standard",
    "everything",
    "deployment",
    "status",
    "step",
    "waiting",
    "Safari",
    "keyboard",
    "setup",
    "documentation",
    "keys",
    "secrets",
    "certificates",
    "right",
    "refresh",
    "moment",
    "tab",
    "number",
    "format",
    "lesson",
    "official Microsoft documentation page",
    "web app settings",
    "application settings",
    "first-name goeth",
    "one level",
    "platform features",
    "resource manager",
    "key ball",
    "key vault",
    "key Balt",
    "principal principal",
    "Microsoft key",
    "one thing",
    "new version",
    "enough time",
    "function app",
    "secret identifier",
    "access policy",
    "URL",
    "value",
    "pair",
    "save",
    "load",
    "earth",
    "issue",
    "information",
    "person",
    "identity",
    "system",
    "status",
    "policies",
    "services",
    "everything",
    "Keeble",
    "overview",
    "keyboard",
    "template",
    "secrets",
    "connection",
    "properties",
    "advanced",
    "editor",
    "link",
    "things",
    "copy",
    "gwyneth",
    "GPS",
    "initials",
    "create",
    "work",
    "rotation",
    "keys",
    "key vault",
    "important credentials",
    "key ball",
    "useful tool",
    "next video",
    "identity",
    "function",
    "policy",
    "security",
    "code",
    "helpful",
    "videos",
    "Azure",
    "recommendations"
  ]
}